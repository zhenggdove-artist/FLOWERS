<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æ®–æ°‘ä¹‹èŠ± AR</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background: #000;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100vh;
			font-family: Arial, sans-serif;
			overflow: hidden;
			position: fixed;
			width: 100%;
		}

		/* ç›¸æ©Ÿ video - å…¨è¢å¹• */
		#video {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: cover;
			z-index: 1;
		}

		/* Canvas å‰æ™¯ - ç¹ªè£½å°ç„¦æ¡†å’Œæ–¹å¡Š */
		#canvas {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 10;
			pointer-events: none;
		}

		/* å•Ÿå‹•æŒ‰éˆ• */
		button {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			margin: 0;
			padding: 30px 70px;
			font-size: 28px;
			font-weight: bold;
			background: white;
			color: #667eea;
			border: none;
			border-radius: 50px;
			cursor: pointer;
			z-index: 1000;
			box-shadow: 0 10px 40px rgba(0,0,0,0.4);
		}

		button:active {
			background: #f0f0f0;
		}

		button.hidden {
			display: none;
		}

		/* å•Ÿå‹•ç•«é¢èƒŒæ™¯ */
		#startBg {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			z-index: 999;
		}

		#startBg.hidden {
			display: none;
		}

		/* æ¨™é¡Œ */
		.title {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -200%);
			color: white;
			font-size: 48px;
			font-weight: bold;
			z-index: 1001;
			text-shadow: 0 4px 15px rgba(0,0,0,0.3);
		}

		.title.hidden {
			display: none;
		}

		/* æ‹ç…§æŒ‰éˆ• */
		#captureBtn {
			position: fixed;
			bottom: 50px;
			left: 50%;
			transform: translateX(-50%);
			width: 90px;
			height: 90px;
			border-radius: 50%;
			background: white;
			border: 7px solid rgba(255,255,255,0.6);
			box-shadow: 0 0 0 5px rgba(0,0,0,0.3), 0 10px 35px rgba(0,0,0,0.6);
			font-size: 45px;
			cursor: pointer;
			z-index: 20;
			display: none;
			align-items: center;
			justify-content: center;
			padding: 0;
			margin: 0;
			transform-origin: center;
		}

		#captureBtn.active {
			display: flex;
		}

		#captureBtn:active {
			transform: translateX(-50%) scale(0.9);
		}

		/* é ‚éƒ¨æ¨™é¡Œ */
		#topTitle {
			position: fixed;
			top: 50px;
			left: 50%;
			transform: translateX(-50%);
			color: white;
			font-size: 32px;
			font-weight: bold;
			text-shadow: 0 3px 12px rgba(0,0,0,0.9);
			background: rgba(0,0,0,0.4);
			padding: 15px 30px;
			border-radius: 30px;
			backdrop-filter: blur(15px);
			-webkit-backdrop-filter: blur(15px);
			z-index: 20;
			display: none;
		}

		#topTitle.active {
			display: block;
		}

		#status {
			color: white;
			margin: 10px;
			text-align: center;
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			z-index: 999;
			background: rgba(0,0,0,0.7);
			padding: 10px 20px;
			border-radius: 20px;
			font-size: 16px;
		}
	</style>
</head>
<body>
	<!-- å•Ÿå‹•èƒŒæ™¯ -->
	<div id="startBg"></div>

	<!-- å•Ÿå‹•æ¨™é¡Œ -->
	<div class="title">ğŸŒ¸ æ®–æ°‘ä¹‹èŠ±</div>

	<!-- ç‹€æ…‹è¨Šæ¯ -->
	<div id="status">é»æ“ŠæŒ‰éˆ•å•Ÿå‹•ç›¸æ©Ÿ</div>

	<!-- å•Ÿå‹•æŒ‰éˆ• -->
	<button id="start">é–‹å§‹é«”é©—</button>

	<!-- ç›¸æ©Ÿ video -->
	<video id="video" autoplay playsinline muted></video>

	<!-- Canvas å‰æ™¯ -->
	<canvas id="canvas"></canvas>

	<!-- é ‚éƒ¨æ¨™é¡Œ -->
	<div id="topTitle">ğŸŒ¸ AR æ®–æ°‘ä¹‹èŠ±</div>

	<!-- æ‹ç…§æŒ‰éˆ• -->
	<button id="captureBtn">ğŸ“·</button>

	<script>
		const video = document.getElementById('video');
		const button = document.getElementById('start');
		const status = document.getElementById('status');
		const canvas = document.getElementById('canvas');
		const ctx = canvas.getContext('2d');
		const startBg = document.getElementById('startBg');
		const titleEl = document.querySelector('.title');
		const captureBtn = document.getElementById('captureBtn');
		const topTitle = document.getElementById('topTitle');

		let flowers = [];
		let animationRunning = false;

		// Canvas å°ºå¯¸
		function resizeCanvas() {
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
		}
		window.addEventListener('resize', resizeCanvas);
		resizeCanvas();

		// ç¹ªè£½ UI
		function draw() {
			if (!animationRunning) return;

			ctx.clearRect(0, 0, canvas.width, canvas.height);

			// å°ç„¦æ¡†
			const cx = canvas.width / 2;
			const cy = canvas.height / 2;
			const size = 60;

			ctx.strokeStyle = 'rgba(255, 220, 0, 0.95)';
			ctx.lineWidth = 5;
			ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
			ctx.shadowBlur = 10;

			ctx.beginPath();
			ctx.moveTo(cx - size, cy);
			ctx.lineTo(cx + size, cy);
			ctx.stroke();

			ctx.beginPath();
			ctx.moveTo(cx, cy - size);
			ctx.lineTo(cx, cy + size);
			ctx.stroke();

			ctx.fillStyle = 'rgba(255, 220, 0, 0.95)';
			ctx.beginPath();
			ctx.arc(cx, cy, 8, 0, Math.PI * 2);
			ctx.fill();

			ctx.shadowBlur = 0;

			// èŠ±æœµ
			flowers.forEach(f => {
				const s = 80 * f.scale;
				ctx.save();
				ctx.globalAlpha = f.alpha;
				ctx.shadowColor = 'rgba(0,0,0,0.6)';
				ctx.shadowBlur = 20;
				ctx.shadowOffsetY = 10;

				ctx.fillStyle = f.color;
				ctx.fillRect(f.x - s/2, f.y - s/2, s, s);

				ctx.shadowBlur = 0;
				ctx.strokeStyle = 'white';
				ctx.lineWidth = 5;
				ctx.strokeRect(f.x - s/2, f.y - s/2, s, s);

				ctx.fillStyle = 'white';
				ctx.beginPath();
				ctx.arc(f.x, f.y, 7, 0, Math.PI * 2);
				ctx.fill();

				ctx.restore();

				if (f.scale < 1) f.scale += 0.06;
				if (f.alpha < 1) f.alpha += 0.06;
			});

			requestAnimationFrame(draw);
		}

		// å•Ÿå‹•ç›¸æ©Ÿ - å®Œå…¨ä½¿ç”¨ test_camera.html çš„é‚è¼¯
		button.addEventListener('click', async () => {
			status.textContent = 'æ­£åœ¨è«‹æ±‚ç›¸æ©Ÿæ¬Šé™...';

			try {
				const stream = await navigator.mediaDevices.getUserMedia({
					video: { facingMode: 'environment' }
				});

				video.srcObject = stream;
				await video.play();

				status.textContent = 'âœ… ç›¸æ©Ÿå•Ÿå‹•æˆåŠŸï¼';
				button.classList.add('hidden');
				startBg.classList.add('hidden');
				titleEl.classList.add('hidden');

				// é¡¯ç¤ºæ‹ç…§ UI
				captureBtn.classList.add('active');
				topTitle.classList.add('active');

				// é–‹å§‹ç¹ªè£½
				animationRunning = true;
				draw();

				// éš±è—ç‹€æ…‹è¨Šæ¯
				setTimeout(() => {
					status.style.display = 'none';
				}, 2000);

			} catch (error) {
				status.textContent = 'âŒ éŒ¯èª¤ï¼š' + error.message;
				console.error(error);
			}
		});

		// æ‹ç…§
		captureBtn.addEventListener('click', () => {
			const cx = canvas.width / 2;
			const cy = canvas.height / 2;
			const ox = (Math.random() - 0.5) * 50;
			const oy = (Math.random() - 0.5) * 50;

			const colors = [
				'rgba(255,100,150,0.9)',
				'rgba(150,100,255,0.9)',
				'rgba(100,200,255,0.9)',
				'rgba(255,200,100,0.9)',
				'rgba(100,255,150,0.9)',
				'rgba(255,255,100,0.9)'
			];

			flowers.push({
				x: cx + ox,
				y: cy + oy,
				color: colors[Math.floor(Math.random() * colors.length)],
				scale: 0.3,
				alpha: 0
			});

			// é–ƒå…‰
			const flash = document.createElement('div');
			flash.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:100;pointer-events:none;opacity:0.95;';
			document.body.appendChild(flash);
			setTimeout(() => {
				flash.style.transition = 'opacity 0.5s';
				flash.style.opacity = '0';
				setTimeout(() => flash.remove(), 500);
			}, 100);

			console.log('èŠ±æœµ:', flowers.length);
		});
	</script>
</body>
</html>
